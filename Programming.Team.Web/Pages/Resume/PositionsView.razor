@page "/resume/positions"
@attribute [Authorize]
@inherits ReactiveInjectableComponentBase<PositionsViewModel>

@if(ViewModel != null)
{
    <AlertView Alert="ViewModel.Alert"/>
    <MudButton OnClick="ViewModel.StartAdd.BindCommand<MouseEventArgs>()">Add Position</MudButton>
    <AddPositionView ViewModel="ViewModel.AddViewModel"/>
    @foreach(var position in ViewModel.Entities)
    {
        <PositionView ViewModel="position"/>
    }
}

@code {
    protected override void OnInitialized()
    {
        if (ViewModel != null)
            ViewModel.Entities.CollectionChanged += (s, e) => 
            {
                InvokeAsync(StateHasChanged); 
            };
        base.OnInitialized();
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (ViewModel != null && firstRender)
        {
            await ViewModel.Load.Execute().GetAwaiter();
            
        }
        await base.OnAfterRenderAsync(firstRender);
    }
}
